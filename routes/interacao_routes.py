from fastapi import APIRouter, Query, HTTPException
from core.services.interacao_service import InteracaoService
from typing import List, Dict, Any

router = APIRouter(
    prefix="/interacoes", 
    tags=["üîÑ Intera√ß√µes"],
    responses={
        404: {"description": "Recurso n√£o encontrado"},
        422: {"description": "Dados inv√°lidos"}
    }
)
service = InteracaoService()

@router.post("/", 
    summary="Registrar nova intera√ß√£o",
    description="Registra uma nova intera√ß√£o de um usu√°rio respondendo uma pergunta em um totem espec√≠fico.",
    response_description="Intera√ß√£o registrada com sucesso")
def criar_interacao(
    vem_hash: str = Query(..., description="Hash √∫nico do usu√°rio", example="user123"),
    pergunta_id: str = Query(..., description="ID da pergunta respondida", example="pergunta001"),
    totem_id: str = Query(..., description="ID do totem onde ocorreu a intera√ß√£o", example="totem001"),
    resposta: str = Query(..., description="Resposta do usu√°rio (sim ou n√£o)", example="sim")
):
    """
    ## üîÑ Registrar Nova Intera√ß√£o
    
    Registra uma nova intera√ß√£o de um usu√°rio respondendo uma pergunta em um totem espec√≠fico.
    
    ### Par√¢metros:
    - **vem_hash** (string): Hash √∫nico do usu√°rio
    - **pergunta_id** (string): ID da pergunta respondida
    - **totem_id** (string): ID do totem onde ocorreu a intera√ß√£o
    - **resposta** (string): Resposta do usu√°rio ("sim" ou "n√£o")
    
    ### Exemplo de uso:
    ```
    POST /interacoes/?vem_hash=user123&pergunta_id=pergunta001&totem_id=totem001&resposta=sim
    ```
    
    ### Resposta:
    ```json
    {
        "vem_hash": "user123",
        "pergunta_id": "pergunta001",
        "totem_id": "totem001",
        "resposta": "sim"
    }
    ```
    
    ### Valida√ß√µes:
    - A resposta deve ser exatamente "sim" ou "n√£o"
    - O usu√°rio, pergunta e totem devem existir no sistema
    """
    if resposta not in ["sim", "n√£o"]:
        raise HTTPException(status_code=422, detail="Resposta deve ser 'sim' ou 'n√£o'")
    
    return service.registrar_interacao(vem_hash, pergunta_id, totem_id, resposta)

@router.get("/", 
    summary="Listar todas as intera√ß√µes",
    description="Retorna uma lista com todas as intera√ß√µes registradas no sistema.",
    response_description="Lista de intera√ß√µes")
def listar_interacoes():
    """
    ## üìã Listar Todas as Intera√ß√µes
    
    Retorna uma lista com todas as intera√ß√µes registradas no sistema.
    
    ### Resposta:
    ```json
    [
        {
            "vem_hash": "user123",
            "pergunta_id": "pergunta001",
            "totem_id": "totem001",
            "resposta": "sim"
        }
    ]
    ```
    
    ### Uso para An√°lise:
    Esta lista pode ser usada para:
    - An√°lise de satisfa√ß√£o
    - An√°lise geogr√°fica
    - An√°lise temporal
    - Dashboards de Big Data
    """
    return service.listar_interacoes()
